@page "/pagos/resultado/{token}"
@page "/pagos/resultado"
@using MudBlazor

<MudContainer MaxWidth="MaxWidth.Medium" Class="mx-auto mt-6">
    @if (Loading)
    {
        <MudSkeleton Height="60px" Class="mb-4" />
        <MudSkeleton Height="220px" />
    }
    else if (!string.IsNullOrWhiteSpace(Error))
    {
        <div class="banner banner-error">
            <MudIcon Icon="@Icons.Material.Filled.Error" Size="Size.Large" Class="mr-2" />
            <MudText Typo="Typo.h5" Class="m-0">@Error</MudText>
        </div>
    }
    else if (Data is not null)
    {
        <div class="banner @BannerCss">
            <MudIcon Icon="@BannerIcon" Size="Size.Large" Class="mr-2" />
            <MudText Typo="Typo.h5" Class="m-0">@BannerText</MudText>
        </div>

        @* --- Bloque de datos del cliente --- *@
        <MudCard Class="mt-3 shadow-sm">
            <MudCardContent Class="p-4">
                <MudGrid Spacing="2">
                    @if (!string.IsNullOrWhiteSpace(Data.DisplayCustomer))
                    {
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.subtitle1" Class="font-bold">Cliente</MudText>
                            <MudText>@Data.DisplayCustomer</MudText>
                        </MudItem>
                    }
                    @if (!string.IsNullOrWhiteSpace(Data.Pais))
                    {
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.subtitle1" Class="font-bold">País</MudText>
                            <MudText>@GetCountryName(Data.Pais)</MudText>

                        </MudItem>
                    }
                    @if (!string.IsNullOrWhiteSpace(Data.Cedula))
                    {
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.subtitle1" Class="font-bold">Cédula</MudText>
                            <MudText>@Data.Cedula</MudText>
                        </MudItem>
                    }
                    @if (!string.IsNullOrWhiteSpace(Data.Email))
                    {
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.subtitle1" Class="font-bold">Correo</MudText>
                            <MudText>@Data.Email</MudText>
                        </MudItem>
                    }
                </MudGrid>
            </MudCardContent>
        </MudCard>

        @* --- Bloque de datos de la transacción --- *@
        <MudCard Class="mt-3 shadow-sm">
            <MudCardContent Class="p-4">
                <MudGrid Spacing="2">
                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Class="font-bold">Fecha de Transacción</MudText>
                        <MudText>@Data.FechaTransaccion.ToLocalTime().ToString("dd/MM/yyyy")</MudText>
                    </MudItem>

                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Class="font-bold">Descripción</MudText>
                        <MudText>@(Data.Estado?.ToLowerInvariant() == "aprobado" ? "Transacción aprobada" : Data.Estado)</MudText>
                    </MudItem>

                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Class="font-bold">Autorización</MudText>
                        <MudText>@(string.IsNullOrWhiteSpace(Data.NumeroAutorizacion) ? "-" : Data.NumeroAutorizacion)</MudText>
                    </MudItem>

                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Class="font-bold">Marca</MudText>
                        <MudText>@(string.IsNullOrWhiteSpace(Data.MarcaTarjeta) ? "-" : Data.MarcaTarjeta)</MudText>
                    </MudItem>

                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Class="font-bold">Orden</MudText>
                        <MudText>@Data.NumeroOrden</MudText>
                    </MudItem>

                    @if (!string.IsNullOrWhiteSpace(Data.TilopayTx))
                    {
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.subtitle1" Class="font-bold">Id Tilopay</MudText>
                            <MudText>@Data.TilopayTx</MudText>
                        </MudItem>
                    }
                </MudGrid>
            </MudCardContent>
        </MudCard>

        <div class="amount-center">
            <MudText Typo="Typo.overline">MONTO CANCELADO</MudText>
            <MudText Typo="Typo.h4" Class="mb-0">@($"{Data.Monto:N2}")</MudText>
            <MudText Typo="Typo.caption" Class="mt-1">@Data.Moneda</MudText>
        </div>

        <div class="d-flex justify-center mt-4 mb-4">
            <MudButton Variant="Variant.Filled" Color="Color.Info" OnClick="VolverInicio" ButtonType="ButtonType.Submit">
                VOLVER AL INICIO
            </MudButton>
        </div>
    }
</MudContainer>

<style>
    .banner {
        display: flex;
        align-items: center;
        border-radius: 10px;
        padding: 14px 16px;
        color: #fff;
    }

    .banner-success {
        background: #08c25e;
    }

    .banner-warning {
        background: #f59e0b;
    }

    .banner-error {
        background: #ef4444;
    }

    .font-bold {
        font-weight: 700;
    }

    .amount-center {
        text-align: center;
        margin-top: 20px;
        margin-bottom: 10px;
    }
</style>
